<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>📋 Lista de Chamada - Inglês</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { padding: 20px; }
    .table td, .table th { vertical-align: middle; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">📚 Lista de Chamada - Aula de Inglês</h1>

    <div class="row mb-3">
      <div class="col-md-4">
        <input type="text" id="aluno" class="form-control" placeholder="👤 Nome do aluno" />
      </div>
      <div class="col-md-3">
        <input type="date" id="data" class="form-control" />
      </div>
      <div class="col-md-3">
        <select id="status" class="form-control">
          <option value="Presente">✅ Presente</option>
          <option value="Faltou">❌ Faltou</option>
        </select>
      </div>
      <div class="col-md-2 d-grid">
        <button onclick="adicionarAluno()" class="btn btn-success">Adicionar</button>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <input type="text" id="busca" class="form-control" placeholder="🔍 Buscar aluno..." onkeyup="buscarAluno()" />
      </div>
      <div class="col-md-6 text-end">
        <button onclick="exportarPDF()" class="btn btn-outline-danger">📄 Exportar PDF</button>
        <button onclick="exportarCSV()" class="btn btn-outline-secondary">📁 Exportar CSV</button>
      </div>
    </div>

    <table class="table table-bordered table-hover" id="tabelaChamada">
      <thead class="table-light">
        <tr>
          <th>👤 Aluno</th>
          <th>📅 Data</th>
          <th>✅ Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="mt-3 text-end">
      <button class="btn btn-outline-success" id="botaoWhatsapp" onclick="enviarWhatsApp()">📱 WhatsApp</button>
      <button class="btn btn-outline-primary" id="botaoEmail" onclick="enviarEmail()">📧 E-mail</button>
    </div>
  </div>

  <script>
    function adicionarAluno() {
      const aluno = document.getElementById("aluno").value.trim();
      const data = document.getElementById("data").value;
      const status = document.getElementById("status").value;

      if (!aluno || !data || !status) {
        alert("Por favor, preencha todos os campos.");
        return;
      }

      const tabela = document.querySelector("#tabelaChamada tbody");
      const novaLinha = tabela.insertRow();
      novaLinha.innerHTML = `
        <td>${aluno}</td>
        <td>${new Date(data).toLocaleDateString()}</td>
        <td>${status}</td>
      `;

      document.getElementById("aluno").value = "";
      document.getElementById("data").value = "";
      document.getElementById("status").value = "Presente";
    }

    function buscarAluno() {
      const termo = document.getElementById("busca").value.toLowerCase();
      const linhas = document.querySelectorAll("#tabelaChamada tbody tr");

      linhas.forEach(linha => {
        const nome = linha.cells[0].textContent.toLowerCase();
        linha.style.display = nome.includes(termo) ? "" : "none";
      });
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const linhas = document.querySelectorAll("#tabelaChamada tbody tr");

      doc.setFontSize(14);
      doc.text("📋 Lista de Chamada", 10, 10);

      let y = 20;
      linhas.forEach(linha => {
        const nome = linha.cells[0].innerText;
        const data = linha.cells[1].innerText;
        const status = linha.cells[2].innerText;
        doc.text(`👤 ${nome} | 📅 ${data} | ✅ ${status}`, 10, y);
        y += 10;
      });

      doc.save("lista_chamada.pdf");
    }

    function exportarCSV() {
      const linhas = document.querySelectorAll("#tabelaChamada tbody tr");
      let csv = "Aluno,Data,Status\n";

      linhas.forEach(linha => {
        const nome = linha.cells[0].innerText;
        const data = linha.cells[1].innerText;
        const status = linha.cells[2].innerText;
        csv += `"${nome}","${data}","${status}"\n`;
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "lista_chamada.csv";
      link.click();
    }

    function gerarMensagemChamada() {
      const linhas = document.querySelectorAll('#tabelaChamada tbody tr');
      if (linhas.length === 0) return 'Nenhum aluno foi registrado ainda.';

      let mensagem = '📋 Lista de Chamada:\n\n';
      linhas.forEach(linha => {
        const cols = linha.querySelectorAll('td');
        mensagem += `👤 ${cols[0].innerText} | 📅 ${cols[1].innerText} | ✅ ${cols[2].innerText}\n`;
      });
      return mensagem;
    }

    function enviarWhatsApp() {
      const mensagem = encodeURIComponent(gerarMensagemChamada());
      const numero = ''; // Ex: 5599999999999
      const url = `https://wa.me/${numero}?text=${mensagem}`;
      window.open(url, '_blank');
    }

    function enviarEmail() {
      const assunto = encodeURIComponent('📋 Lista de Chamada - Aula de Inglês');
      const corpo = encodeURIComponent(gerarMensagemChamada());
      const emailDestino = ''; // Ex: professor@exemplo.com
      const mailto = `mailto:${emailDestino}?subject=${assunto}&body=${corpo}`;
      window.open(mailto, '_blank');
    }
  </script>
</body>
</html>