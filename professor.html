<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Professor</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-4">
    <h2 id="profTitle">Painel do Professor</h2>
    <button class="btn btn-danger float-end" onclick="logout()">Logout</button>

    <form id="chamadaForm" class="my-4">
      <input type="text" id="aluno" class="form-control" placeholder="Nome do aluno" required />
      <button class="btn btn-success mt-2">Salvar Chamada</button>
    </form>

    <h4>Minhas Chamadas</h4>
<ul class="list-group" id="listaChamadas"></ul>

<div class="mt-3">
  <button class="btn btn-outline-primary me-2" onclick="exportarCSV()">Exportar CSV</button>
  <button class="btn btn-outline-danger" onclick="exportarPDF()">Exportar PDF</button>
</div>

  <script>
    const user = JSON.parse(localStorage.getItem('usuarioLogado'));
    if (!user || user.role !== 'professor') window.location.href = 'login.html';

    function logout() {
      localStorage.removeItem("usuarioLogado");
      window.location.href = "login.html";
    }

    function carregarChamadas() {
      const chamadas = JSON.parse(localStorage.getItem('chamadas')) || [];
      const minhasChamadas = chamadas.filter(c => c.professor === user.nome);
      const lista = document.getElementById("listaChamadas");
      lista.innerHTML = "";
      minhasChamadas.forEach((c, i) => {
        lista.innerHTML += `<li class="list-group-item">${c.data} - ${c.aluno}</li>`;
      });
    }

    document.getElementById("chamadaForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const aluno = document.getElementById("aluno").value;
      const novaChamada = {
        professor: user.nome,
        aluno,
        data: new Date().toLocaleDateString()
      };
      const chamadas = JSON.parse(localStorage.getItem('chamadas')) || [];
      chamadas.push(novaChamada);
      localStorage.setItem('chamadas', JSON.stringify(chamadas));
      document.getElementById("aluno").value = "";
      carregarChamadas();
    });

    carregarChamadas();

    function exportarCSV() {
        const chamadas = JSON.parse(localStorage.getItem('chamadas')) || [];
        const minhasChamadas = chamadas.filter(c => c.professor === user.nome);
      
        let csv = "Data,Aluno\n";
        minhasChamadas.forEach(c => {
          csv += `${c.data},${c.aluno}\n`;
        });
      
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "chamadas.csv";
        link.click();
      }
      
      function exportarPDF() {
        const minhasChamadas = JSON.parse(localStorage.getItem('chamadas'))
          .filter(c => c.professor === user.nome);
      
        let texto = `RelatÃ³rio de Chamadas - Professor: ${user.nome}\n\n`;
        minhasChamadas.forEach(c => {
          texto += `Data: ${c.data} | Aluno: ${c.aluno}\n`;
        });
      
        const janela = window.open("", "", "width=800,height=600");
        janela.document.write("<pre>" + texto + "</pre>");
        janela.document.close();
        janela.print();
      }
  </script>
</body>
</html>